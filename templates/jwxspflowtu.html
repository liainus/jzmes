<!DOCTYPE html><html lang="en"><head>    <meta charset="UTF-8">    <title>健胃消食片计划管理</title>    <link href="../static/css/base.css" rel="stylesheet">	<link rel="stylesheet" href="../static/custom/uimaker/easyui.css">	<link href="../static/css/basic_info.css" rel="stylesheet">	<link rel="stylesheet" type="text/css" href="../static/custom/uimaker/icon.css">	<link href="../static/js/umeditor/themes/default/css/umeditor.css" type="text/css" rel="stylesheet">    <link href="../static/css/datagridpanel_customer.css" rel="stylesheet">    <link href="../static/css/dialogpanel.css" type="text/css" rel="stylesheet">    <link href="../static/css/datagrid_customer.css" type="text/css" rel="stylesheet">    <script type="text/javascript" src="../static/js/jquery-3.3.1.min.js"></script>    <script type="text/javascript" src="../static/js/jquery.easyui.min.js"></script>    <script type="text/javascript" src="../static/js/easyui-lang-zh_CN.js"></script>    <script type="text/javascript" src="../static/js/bee.js" charset="utf-8"></script>    <style>        /*横向时间轴*/        .progress-head{            position: relative;            padding:50px 0px;            margin: 0 20px;            display: -webkit-box;            overflow: scroll;        }        .progress-head:after{            content: '';            display: block;            clear: both;        }        .host-progress{            position: relative;            float: left;        }        .host-ball{            float: left;            width: 80px;            height: 30px;            line-height: 30px;            border-radius: 3px;            background-color: #9f9f9f;            color: #fff;            text-align: center;            white-space: nowrap;            cursor: pointer;        }        .host-line{            position: relative;            float: left;            width: 50px;            height: 2px;            margin-top: 15px;            background-color: #9F9F9F;            z-index: 3;        }        .host-arrow{            position: relative;        }        .host-arrow:after,.host-arrow:before{            width: 0;            height: 0;            border: 10px solid transparent;            border-left-color: #9f9f9f;            position: absolute;            content: "";            top: 6px;            left:120px;        }        .host-arrow:before{            top: 6px;            left: 117px;            border-left-color: white;            z-index: 2;        }        .host-progress-active .host-arrow:after{            border-left-color: #5cb85c;        }        .host-progress-way-active .host-arrow:after{            border-left-color: #ffac38;        }        .childBox{            width:130px;        }        .childNode{            margin-left: 10px;        }        /*纵向时间轴*/        .ball{            display: block;            width: 20px;            height: 20px;            border-radius: 10px;            margin-left: 20px;            background-color: #9f9f9f;            cursor: pointer;        }        .progress-line{            width: 0px;            height: 50px;            margin-left: 30px;            border-left: 1px dashed #9f9f9f;        }        .progress-line.progress-line-active{            border-left: 1px dashed #5cb85c;        }        .detail{            margin-left: 40px;            float:left;            font-size: 12px;            color: #666;            line-height:20px;            position: relative;            top: -20px;            left: 5px;        }        .flow-detail{            margin-bottom: 10px;        }        .ball-active{            background-color: #5cb85c;        }        .ball-stay{            background-color: #ffac38;        }        .proTooltip{            position: absolute;            top:0;            left:0;            display: flex;        }        .proTooltip li{            float: left;            height:35px;            line-height: 35px;            color: #0c5460;            background-color: #d1ecf1;            text-align: center;            margin-right: 50px;            border: 1px solid #bee5eb;            border-radius: .25rem;        }    </style>    <script>        $(function(){            function createKeyIDObj(keyID){                return {                    ID:keyID                }            }            CollectToolbar = {                search:function(){                    var searchBatchID = $('input[name="search"]').val()                    $("#tab").datagrid({                        queryParams: {                            BatchID: searchBatchID,                            name:'健胃消食片浸膏粉'                        }                    })                },                refresh:function(){                    $("#tab").datagrid('load')                    $(".host-progress").find(".host-ball").removeClass("ball-active ball-stay").siblings(".host-line").removeClass("ball-active")                }            }            $("#tab").datagrid({                onLoadSuccess:function(d){                    $(this).datagrid("selectRow", 0);                    var rows = $("#tab").datagrid('getSelections');                    $(".host-progress").find(".host-ball").removeClass("ball-active ball-stay").siblings(".host-line").removeClass("ball-active ball-stay").parents(".host-progress").removeClass("host-progress-active host-progress-way-active")                    $(".bigPlan5,.bigPlan6,.bigPlan7,.bigPlan8,.bigPlan9").find(".ball").removeClass("ball-active").siblings(".progress-line").removeClass("progress-line-active")                    if(rows[0].PlanStatus == "10"){                        $(".bigPlan1").find(".host-ball").addClass("ball-active").siblings(".host-line").addClass("ball-active").parents(".host-progress").addClass("host-progress-active")                        $(".bigPlan2").find(".host-ball").addClass("ball-stay")                    }else if(rows[0].PlanStatus == "11"){                        $(".bigPlan1,.bigPlan2").find(".host-ball").addClass("ball-active").siblings(".host-line").addClass("ball-active").parents(".host-progress").addClass("host-progress-active")                        $(".bigPlan3").find(".host-ball").addClass("ball-stay")                    }else if(rows[0].PlanStatus == "20"){                        $(".bigPlan1,.bigPlan2,.bigPlan3").find(".host-ball").addClass("ball-active").siblings(".host-line").addClass("ball-active").parents(".host-progress").addClass("host-progress-active")                        $(".bigPlan4").find(".host-ball").addClass("ball-stay")                    }else if(rows[0].PlanStatus == "30"){                        $(".bigPlan1,.bigPlan2,.bigPlan3,.bigPlan4").find(".host-ball").addClass("ball-active").siblings(".host-line").addClass("ball-active").parents(".host-progress").addClass("host-progress-active")                        $(".bigPlan5,.bigPlan6,.bigPlan7,.bigPlan8,.bigPlan9").find(".host-ball").addClass("ball-stay").siblings(".host-line").addClass("ball-stay").parents(".host-progress").addClass("host-progress-way-active")                    }else if(rows[0].PlanStatus == "60"){                        $(".bigPlan1,.bigPlan2,.bigPlan3,.bigPlan4,.bigPlan5,.bigPlan6,.bigPlan7,.bigPlan8,.bigPlan9,.bigPlan10").find(".host-ball").addClass("ball-active").siblings(".host-line").addClass("ball-active").parents(".host-progress").addClass("host-progress-active")                        $(".bigPlan5,.bigPlan6,.bigPlan7,.bigPlan8,.bigPlan9").find(".ball").addClass("ball-active").siblings(".progress-line").addClass("progress-line-active")                    }else if(rows[0].PlanStatus == "70"){                        $(".bigPlan1,.bigPlan2,.bigPlan3,.bigPlan4,.bigPlan5,.bigPlan6,.bigPlan7,.bigPlan8,.bigPlan9,.bigPlan10").find(".host-ball").addClass("ball-active").siblings(".host-line").addClass("ball-active").parents(".host-progress").addClass("host-progress-active")                        $(".bigPlan5,.bigPlan6,.bigPlan7,.bigPlan8,.bigPlan9").find(".ball").addClass("ball-active").siblings(".progress-line").addClass("progress-line-active")                    }                    $.ajax({                        url: '/PlanExecutionProgress/planmanagerProgressTuSearch',                        method: 'POST',                        data: {                            ID: rows[0].ID                        },                        success: function (data) {                            data = JSON.parse(data)                            for(var key in data){                                if(data[key] == "OK"){                                    addgreen(key)                                }                            }                        },                        error: function () {                            alert("请求失败，请稍后重试！")                        }                    });                },                onClickRow:function(rowIndex,rowData){                    $(".host-progress").find(".host-ball").removeClass("ball-active ball-stay").siblings(".host-line").removeClass("ball-active ball-stay").parents(".host-progress").removeClass("host-progress-active host-progress-way-active")                    $(".bigPlan5,.bigPlan6,.bigPlan7,.bigPlan8,.bigPlan9").find(".ball").removeClass("ball-active").siblings(".progress-line").removeClass("progress-line-active")                    if(rowData.PlanStatus == "10"){                        $(".bigPlan1").find(".host-ball").addClass("ball-active").siblings(".host-line").addClass("ball-active").parents(".host-progress").addClass("host-progress-active")                        $(".bigPlan2").find(".host-ball").addClass("ball-stay")                    }else if(rowData.PlanStatus == "11"){                        $(".bigPlan1,.bigPlan2").find(".host-ball").addClass("ball-active").siblings(".host-line").addClass("ball-active").parents(".host-progress").addClass("host-progress-active")                        $(".bigPlan3").find(".host-ball").addClass("ball-stay")                    }else if(rowData.PlanStatus == "20"){                        $(".bigPlan1,.bigPlan2,.bigPlan3").find(".host-ball").addClass("ball-active").siblings(".host-line").addClass("ball-active").parents(".host-progress").addClass("host-progress-active")                        $(".bigPlan4").find(".host-ball").addClass("ball-stay")                    }else if(rowData.PlanStatus == "30"){                        $(".bigPlan1,.bigPlan2,.bigPlan3,.bigPlan4").find(".host-ball").addClass("ball-active").siblings(".host-line").addClass("ball-active").parents(".host-progress").addClass("host-progress-active")                        $(".bigPlan5,.bigPlan6,.bigPlan7,.bigPlan8,.bigPlan9").find(".host-ball").addClass("ball-stay").siblings(".host-line").addClass("ball-stay").parents(".host-progress").addClass("host-progress-way-active")                    }else if(rowData.PlanStatus == "60"){                        $(".bigPlan1,.bigPlan2,.bigPlan3,.bigPlan4,.bigPlan5,.bigPlan6,.bigPlan7,.bigPlan8,.bigPlan9,.bigPlan10").find(".host-ball").addClass("ball-active").siblings(".host-line").addClass("ball-active").parents(".host-progress").addClass("host-progress-active")                        $(".bigPlan5,.bigPlan6,.bigPlan7,.bigPlan8,.bigPlan9").find(".ball").addClass("ball-active").siblings(".progress-line").addClass("progress-line-active")                    }else if(rowData.PlanStatus == "70"){                        $(".bigPlan1,.bigPlan2,.bigPlan3,.bigPlan4,.bigPlan5,.bigPlan6,.bigPlan7,.bigPlan8,.bigPlan9,.bigPlan10").find(".host-ball").addClass("ball-active").siblings(".host-line").addClass("ball-active").parents(".host-progress").addClass("host-progress-active")                        $(".bigPlan5,.bigPlan6,.bigPlan7,.bigPlan8,.bigPlan9").find(".ball").addClass("ball-active").siblings(".progress-line").addClass("progress-line-active")                    }                    $.ajax({                        url: '/PlanExecutionProgress/planmanagerProgressTuSearch',                        method: 'POST',                        data: {                            ID: rowData.ID                        },                        success: function (data) {                            data = JSON.parse(data)                            for(var key in data){                                if(data[key] == "OK"){                                    addgreen(key)                                }                            }                        },                        error: function () {                            alert("请求失败，请稍后重试！")                        }                    });                }            });            function addgreen(ids){                $("#" + ids).addClass("ball-active").siblings(".progress-line").addClass("progress-line-active")            }            //有此权限时增加tabs跳转到操作页面 新增-审核-下发-放行            $(".handlePlan").on('click',function(){                var text = $(this).html()                var src = $(this).attr("skip-src")                $.ajax({                    url: '/ZYPlanGuid/menuRedirect',                    method: 'POST',                    data: {                        menuName: text                    },                    success: function (data) {                        if (data == "OK") {                            addTab(text,src)                        }else{                            $.messager.alert('提示', data, 'info');                        }                    },                    error: function () {                        alert("请求失败，请稍后重试！")                    }                });            })            //有此权限时增加tabs跳转到操作页面 任务确认            $(".taskConfirm").on('click',function(){                var rows = $("#tab").datagrid('getSelections'); //选择的计划                var text = $(this).attr("name") //点击标记                var jumpUrl = encodeURI("/taskConfirm?BrandID=" + rows[0].BrandID + "&BatchID=" + rows[0].BatchID + "&name=" + text);                addTab(rows[0].BatchID +"任务确认（" + text +"）",jumpUrl)            })            //增加tabs跳转到批次计划明细            $(".batchRecord").on('click',function(){                var rows = $("#tab").datagrid('getSelections'); //选择的计划                var text = $(this).html() //点击标记                var jumpUrl = encodeURI("/batchmanager?ID=" + rows[0].ID + "&name=" + text);                addTab("批次计划明细（" + text +"）",jumpUrl)            })        })        //按钮点击后添加选项卡        function addTab(title, url) {            if (parent.parent.$('.easyui-tabs1').tabs('exists', title)) {                parent.parent.$('.easyui-tabs1').tabs('select', title);            }            else {                var content = '<iframe class="page-iframe" src="' + url + '" frameborder="no" border="no" height="100%" width="100%" scrolling="auto"></iframe>';                parent.parent.$('.easyui-tabs1').tabs('add', {                    title: title,                    content: content,                    closable: true                });            }        }        function formatterStatus(value, row, index){            if (value == 10){                return '新增计划'            }else if(value == 11){                return '审核计划'            }else if(value == 20){                return '下发计划'            }else if(value == 30){                return '发送到WMS'            }else if(value == 40){                return '撤回计划'            }else if(value == 50){                return '执行计划'            }else if(value == 60){                return '完成计划'            }else if(value == 70){                return 'QA入库'            }        }    </script></head><body>    <div class="content">        <div class="progress-head free dragscroll">            <div class="host-progress bigPlan1">                <div class="host-ball handlePlan easyui-tooltip" skip-src="/createPlanWizard" title="点击开始新增计划">新增计划</div>                <div class="host-line"></div>                <div class="host-arrow"></div>            </div>            <div class="host-progress bigPlan2">                <div class="host-ball handlePlan" skip-src="/ZYPlanGuid/checkplanmanager" title="点击进行审核计划">审核计划</div>                <div class="host-line"></div>                <div class="host-arrow"></div>            </div>            <div class="host-progress bigPlan3">                <div class="host-ball handlePlan" skip-src="/ZYPlanGuid/planmanager" title="点击进行下发计划">下发计划</div>                <div class="host-line"></div>                <div class="host-arrow"></div>            </div>            <div class="host-progress bigPlan4">                <div class="host-ball handlePlan" skip-src="" title="点击发送批记到WMS">发送到WMS</div>                <div class="host-line"></div>                <div class="host-arrow"></div>            </div>            <div class="host-progress bigPlan5">                <div class="host-ball batchRecord" title="点击查看计划明细">备料</div>                <div class="host-line"></div>                <div class="host-arrow"></div>                <div class="childBox">                    <div class="childNode">                        <div class="progress-line"></div>                        <a class="ball taskConfirm" id="aa" name="备料"></a>                        <div class="detail">                            <div class="flow-detail">任务确认</div>                        </div>                    </div>                    <div class="childNode">                        <div class="progress-line"></div>                        <a class="ball operMenu" id="a1" name="备料" rel="生产前的准备"></a>                        <div class="detail">                            <div class="flow-detail">生产前的准备</div>                        </div>                        <div class="progress-line"></div>                    </div>                    <div class="childNode">                        <a class="ball operMenu" id="a2" name="备料" rel="备料开始"></a>                        <div class="detail">                            <div class="flow-detail">备料开始</div>                        </div>                        <div class="progress-line"></div>                    </div>                    <div class="childNode">                        <a class="ball operMenu" id="a3" name="备料" rel="备料结束清场"></a>                        <div class="detail">                            <div class="flow-detail">备料结束清场</div>                        </div>                    </div>                </div>            </div>            <div class="host-progress bigPlan6">                <div class="host-ball batchRecord" title="点击查看计划明细">煎煮</div>                <div class="host-line"></div>                <div class="host-arrow"></div>                <div class="childBox">                    <div class="childNode">                        <div class="progress-line"></div>                        <a class="ball taskConfirm" id="bb" name="煎煮"></a>                        <div class="detail">                            <div class="flow-detail">任务确认</div>                        </div>                    </div>                    <div class="childNode">                        <div class="progress-line"></div>                        <a class="ball operMenu" id="b1" name="煎煮" rel="生产前的准备"></a>                        <div class="detail">                            <div class="flow-detail">生产前的准备</div>                        </div>                        <div class="progress-line"></div>                    </div>                    <div class="childNode">                        <a class="ball operMenu" id="b2" name="煎煮" rel="煎煮开始"></a>                        <div class="detail">                            <div class="flow-detail">煎煮开始</div>                        </div>                        <div class="progress-line"></div>                    </div>                    <div class="childNode">                        <a class="ball operMenu" id="b3" name="煎煮" rel="静置开始"></a>                        <div class="detail">                            <div class="flow-detail">静置开始</div>                        </div>                        <div class="progress-line"></div>                    </div>                    <div class="childNode">                        <a class="ball operMenu" id="b4" name="煎煮" rel="煎煮结束清场"></a>                        <div class="detail">                            <div class="flow-detail">煎煮结束清场</div>                        </div>                    </div>                </div>            </div>            <div class="host-progress bigPlan7">                <div class="host-ball batchRecord" title="点击查看计划明细">浓缩</div>                <div class="host-line"></div>                <div class="host-arrow"></div>                <div class="childBox">                    <div class="childNode">                        <div class="progress-line"></div>                        <a class="ball taskConfirm" id="cc" name="浓缩"></a>                        <div class="detail">                            <div class="flow-detail">任务确认</div>                        </div>                    </div>                    <div class="childNode">                        <div class="progress-line"></div>                        <a class="ball operMenu" id="c1" name="浓缩" rel="生产前的准备"></a>                        <div class="detail">                            <div class="flow-detail">生产前的准备</div>                        </div>                        <div class="progress-line"></div>                    </div>                    <div class="childNode">                        <a class="ball operMenu" id="c2" name="浓缩" rel="浓缩开始"></a>                        <div class="detail">                            <div class="flow-detail">浓缩开始</div>                        </div>                        <div class="progress-line"></div>                    </div>                    <div class="childNode">                        <a class="ball operMenu" id="c3" name="浓缩" rel="浓缩结束清场"></a>                        <div class="detail">                            <div class="flow-detail">浓缩结束清场</div>                        </div>                    </div>                </div>            </div>            <div class="host-progress bigPlan8">                <div class="host-ball batchRecord" title="点击查看计划明细">喷雾干燥</div>                <div class="host-line"></div>                <div class="host-arrow"></div>                <div class="childBox">                    <div class="childNode">                        <div class="progress-line"></div>                        <a class="ball taskConfirm" id="dd" name="喷雾干燥"></a>                        <div class="detail">                            <div class="flow-detail">任务确认</div>                        </div>                    </div>                    <div class="childNode">                        <div class="progress-line"></div>                        <a class="ball operMenu" id="d1" name="喷雾干燥" rel="生产前的准备"></a>                        <div class="detail">                            <div class="flow-detail">生产前的准备</div>                        </div>                        <div class="progress-line"></div>                    </div>                    <div class="childNode">                        <a class="ball operMenu" id="d2" name="喷雾干燥" rel="喷雾干燥开始"></a>                        <div class="detail">                            <div class="flow-detail">喷雾干燥开始</div>                        </div>                        <div class="progress-line"></div>                    </div>                    <div class="childNode">                        <a class="ball operMenu" id="d3" name="喷雾干燥" rel="喷雾干燥结束清场"></a>                        <div class="detail">                            <div class="flow-detail">喷雾干燥结束清场</div>                        </div>                    </div>                </div>            </div>            <div class="host-progress bigPlan9">                <div class="host-ball batchRecord" title="点击查看计划明细">收粉</div>                <div class="host-line"></div>                <div class="host-arrow"></div>                <div class="childBox">                    <div class="childNode">                        <div class="progress-line"></div>                        <a class="ball taskConfirm" id="ee" name="收粉"></a>                        <div class="detail">                            <div class="flow-detail">任务确认</div>                        </div>                    </div>                    <div class="childNode">                        <div class="progress-line"></div>                        <a class="ball operMenu" id="e1" name="收粉" rel="生产前的准备"></a>                        <div class="detail">                            <div class="flow-detail">生产前的准备</div>                        </div>                        <div class="progress-line"></div>                    </div>                    <div class="childNode">                        <a class="ball operMenu" id="e2" name="收粉" rel="收粉开始"></a>                        <div class="detail">                            <div class="flow-detail">收粉开始</div>                        </div>                        <div class="progress-line"></div>                    </div>                    <div class="childNode">                        <a class="ball operMenu" id="e3" name="收粉" rel="收粉结束清场"></a>                        <div class="detail">                            <div class="flow-detail">收粉结束清场</div>                        </div>                    </div>                </div>            </div>            <div class="host-progress bigPlan10">                <div class="host-ball handlePlan" skip-src="/QAauthPass" title="点击进行QA入库">QA入库</div>            </div>            <!-- 部门提示 -->            <ul class="proTooltip">                <li style="width: 468px;">生产管理部门</li>                <li style="width: 596px;">车间操作部门</li>                <li style="width: 80px;">QA部门</li>            </ul>        </div>        <div id="Toolbar" style="padding:0 10px;">            批次号:            <input type="text" class="textbox-text validatebox-text textbox-prompt" name="search" style="height:28px;" autocomplete="off"                placeholder="">            <a href="#" class="easyui-linkbutton" data-options="iconCls:'icon-search'" onclick="CollectToolbar.search();">查询</a>            <a href="#" class="easyui-linkbutton" id="reload" data-options="iconCls:'icon-reload'" onclick="CollectToolbar.refresh();">刷新</a>        </div>        <table class="easyui-datagrid" id="tab" title="健胃消食片制药计划列表" style="width:100%;" data-options="            queryParams: {                BatchID: '',                name:'健胃消食片浸膏粉'            },            rownumbers:true,            singleSelect:true,            autoRowHeight:false,            pagination:true,            pageSize:10,            toolbar:'#Toolbar',            url:'/allPlanManagers/Search',            method:'post'">            <thead>                <tr>                    <th field="ck" checkbox="true"></th>                    <th data-options="field:'PlanStatus',width:150,align:'center'" formatter="formatterStatus">计划状态</th>                    <th data-options="field:'SchedulePlanCode',width:200,align:'center'">调度编号</th>                    <th data-options="field:'BatchID',width:200,align:'center'">批次号</th>                    <th data-options="field:'PlanQuantity',width:100,align:'center'">计划重量</th>                    <th data-options="field:'BrandName',width:150,align:'center'">品名</th>                    <th data-options="field:'Unit',width:100,align:'center'">单位</th>                    <th data-options="field:'PlanBeginTime',width:200,align:'center'">计划开始时间</th>                    <th data-options="field:'PlanEndTime',width:200,align:'center'">计划完成时间</th>                    <th data-options="field:'Type',width:100,align:'center'">调度类型</th>                </tr>            </thead>        </table>    </div></body><script>    window.addEventListener("load", function() {        var addEventListener = 'addEventListener';        var elems = document.getElementsByClassName('dragscroll');        for (var i = 0; i < elems.length;) {            (function(elem, lastClientX, lastClientY, pushed) {                elem[addEventListener]('mousedown', function(e) {                    pushed = 1;                    lastClientX = e.clientX;                    lastClientY = e.clientY;                    e.preventDefault();                    e.stopPropagation();                }, 0);                window[addEventListener]('mousemove', function(e) {                    if (pushed) {                        elem.scrollLeft -=                            (- lastClientX + (lastClientX=e.clientX));                        elem.scrollTop -=                            (- lastClientY + (lastClientY=e.clientY));                    }                }, 0);                window[addEventListener]('mouseup', function(){                    pushed = 0;                }, 0);             })(elems[i++]);        }    }, 0);</script></html>