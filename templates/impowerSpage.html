<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Empower</title>
    <link href="../static/css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../static/css/bootstrap.min.css">
    <link rel="stylesheet" href="../static/css/bootstrap-table.min.css">
	<link rel="stylesheet" href="../static/custom/uimaker/easyui.css">
	<link href="../static/css/basic_info.css" rel="stylesheet">
	<link rel="stylesheet" type="text/css" href="../static/custom/uimaker/icon.css">
	<link href="../static/js/umeditor/themes/default/css/umeditor.css" type="text/css" rel="stylesheet">
    <link href="../static/css/datagridpanel_customer.css" rel="stylesheet">
    <link href="../static/css/dialogpanel.css" type="text/css" rel="stylesheet">
    <link href="../static/css/datagrid_customer.css" type="text/css" rel="stylesheet">
    <script type="text/javascript" src="../static/js/jquery-3.3.1.min.js"></script>
    <script type="text/javascript" src="../static/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../static/js/bootstrap-table.min.js"></script>
    <script type="text/javascript" src="../static/js/jquery.easyui.min.js"></script>
    <script type="text/javascript" src="../static/js/easyui-lang-zh_CN.js"></script>
    <script type="text/javascript" src="../static/js/Bee.js" charset="utf-8"></script>
    <script>
        $(function(){
            $('#LeftTree').tree({
                url:'/impowerSelect',
                method: 'get',
                animate:true,
                loadFilter:function(data){
                    return data
                },
                onClick: function (node) {
                    if($('#LeftTree').tree('isLeaf',node.target)){
                        var parentText = $('#LeftTree').tree('getParent', node.target)
                        {#$.ajax({#}
                        {#    url: '/impowerSelectData',#}
                        {#    type: 'get',#}
                        {#    data: {#}
                        {#        projectName: parentText.text + '\\' + node.text#}
                        {#    },#}
                        {#    success: function (data) {#}
                        {#        console.log(data)#}
                        {#    }#}
                        {# })#}
                        $("#tab").bootstrapTable({
                            method : 'get',
                            url:'/impowerSelectData',
                            striped : true,
                            pageNumber : 1, //初始化加载第一页
                            pagination : true,//是否分页
                            sidePagination : 'client',//server:服务器端分页|client：前端分页
                            pageSize : 5,//单页记录数
                            pageList : [ 5, 10, 20, 30 ],//可选择单页记录数
                            queryParams: {
                                projectName: parentText.text + '\\' + node.text
                            },
                            columns: [{
                                checkbox: true
                            },{
                                field: 'SampleName',
                                title: '样品名称'
                            }, {
                                field: 'SampleBottle',
                                title: '样品瓶'
                            }, {
                                field: 'Sampling',
                                title: '进样'
                            }, {
                                field: 'SampleType',
                                title: '样品类型'
                            }, {
                                field: 'ProcessingChannel',
                                title: '处理通道说明'
                            }, {
                                field: 'CollectionDate',
                                title: '采集日期'
                            }, {
                                field: 'OperationDate',
                                title: '处理日期'
                            }, {
                                field: 'ProcessingMethod',
                                title: '处理方法'
                            }, {
                                field: 'ResultID',
                                title: '结果ID'
                            }],
                            onLoadSuccess:function(data){
                                console.log(data)
                            },
                            onCheck:function(rowIndex,rowData){
                                console.log(rowData.SampleName + "-" + rowData.SampleBottle + "-" + rowData.Sampling)
                                //getNewData(rowData.SampleName,rowData.SampleBottle,rowData.Sampling)
                            }
                         })
                    }
                }
            })
            function getNewData(SampleName,SampleBottle,Sampling){
                var myChart = echarts.init(document.getElementById("main"))
                myChart.showLoading();
                $.ajax({
                    url: '',
                    type: 'get',
                    data: {
                        SampleName:SampleName,
                        SampleBottle:SampleBottle,
                        Sampling:Sampling
                    },
                    success: function (data) {
                        data = JSON.parse(data)
                        myChart.hideLoading();
                        myChart.setOption(option = {
                            tooltip: {
                                trigger: 'item',
                                formatter : function (params) {
                                    var date = new Date(params.value[0]);
                                    data = date.getFullYear() + '-'
                                       + (date.getMonth() + 1) + '-'
                                       + date.getDate() + ' '
                                       + date.getHours() + ':'
                                       + date.getMinutes();
                                    return data + '<br/>'
                                        + params.seriesName + ":" + params.value[1]
                                 }
                            },
                            legend: {
                                data: ["密度"]
                            },
                            toolbox: {
                                feature: {
                                    mark : {show: true},
                                    dataView: {show: true, readOnly: false},
                                    restore: {show: true},
                                    saveAsImage: {show: true}
                                }
                            },
                            dataZoom: {
                                show: true,
                                start : 0
                            },
                            grid: {
                                y2: 80
                            },
                            xAxis: {
                                type : 'value',
                                splitNumber:10
                            },
                            yAxis: {
                                type : 'value',
                                axisLabel: {
                                    formatter: '{value}'
                                }
                            },
                            series: [{
                                name: "密度",
                                type: 'line',
                                showAllSymbol: true,
                                smooth:true,
                                data: data.MD
                            }]
                        });
                        myChart.setOption(option);
                    }
                })
            }
        })
    </script>
</head>
<body style="padding: 15px;">
    <div class="easyui-layout" style="width:100%;height:350px;">
        <div data-options="region:'west',split:true" title="项目" style="width:25%">
            <div class="left-tree" style="padding: 15px;">
                <ul id="LeftTree" class="easyui-tree"></ul>
            </div>
        </div>
        <div data-options="region:'center',title:'结果'">
            <table class="table table-bordered" id="tab"></table>
        </div>
	</div>
    <div class="easyui-layout" style="width:100%;height:350px;">
        <div data-options="region:'center',title:'峰值图'">
            <div id="chart" style="width: 960px; height: 300px; margin: 10px auto;"></div>
        </div>
        <div data-options="region:'east',split:true" title="峰值数据" style="width:25%">
            <table class="easyui-datagrid" id="tab" title="" style="width:100%;" data-options="
                striped:true,
                rownumbers:true,
                autoRowHeight:false,
                method:'get'">
                <thead>
                    <tr>
                        <th data-options="field:'Name',width:150,align:'center'">名称</th>
                        <th data-options="field:'RetentionTime',width:150,align:'center'">保留时间</th>
                        <th data-options="field:'Area',width:150,align:'center'">面积</th>
                        <th data-options="field:'PercentileArea',width:150,align:'center'">%面积</th>
                        <th data-options="field:'Height',width:150,align:'center'">高度</th>
                    </tr>
                </thead>
            </table>
        </div>
	</div>
</body>
</html>