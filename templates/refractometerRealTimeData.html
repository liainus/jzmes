<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>折光仪实时数据</title>
    <link rel="stylesheet" href="../static/css/bootstrap.min.css">
    <script type="text/javascript" src="../static/js/echarts.common.min.js"></script>
    <script type="text/javascript" src="../static/js/jquery-3.3.1.min.js"></script>
    <script type="text/javascript" src="../static/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../static/js/bootbox.min.js"></script>
    <script>
        $(function(){
            if ("WebSocket" in window){
                var ws = new WebSocket("ws://192.168.2.116:5003");
                if(ws.readyState != 1){
                    ws = new WebSocket("ws://111.75.201.235:5003");
                    ws.onopen = function(){
                        ws.send("hello");
                        console.log("数据发送中...");
                    };
                    ws.onmessage = function (evt){
                        var received_msg = evt.data;
                        received_msg = JSON.parse(received_msg)
                        $("#conc").html(received_msg.ZGY_ZGL)
                        $("#temp").html(received_msg.ZGY_Temp)
                    };
                    ws.onclose = function(){
                        console.log("连接已关闭...");
                    };
                }else{
                    ws.onopen = function(){
                        ws.send("hello");
                        console.log("数据发送中...");
                    };
                    ws.onmessage = function (evt){
                        var received_msg = evt.data;
                        received_msg = JSON.parse(received_msg)
                        $("#conc").html(received_msg.ZGY_ZGL)
                        $("#temp").html(received_msg.ZGY_Temp)
                    };
                    ws.onclose = function(){
                        console.log("连接已关闭...");
                    };
                }
            }else{
               bootbox.alert("您的浏览器不支持 WebSocket！无法查看实时数据。");
            }

        })
    </script>
</head>
<body style="background: #e3e5e4;">
    <div class="container">
        <div style="margin: 28px auto;position: relative;background-color: #e3e5e4;">
            <div style="min-height: 380px;border-width: 0 0 0 0px;background-color: #f8f8f8;border-radius: 0 0 17px 0;padding: 15px;">
                <div style="padding-bottom: 5px;border-bottom: 1px solid #e3e5e4;font-size: 25px;font-weight: bold;">
                    <a class="text-left" href="http://192.168.200.88/main.html" target="_blank">折光仪</a>
                    <a class="pull-right" style="font-weight: 500;font-size: 18px;" href="javascript:;">折光仪历史数据</a>
                </div>
                <div style="margin: 70px 20px 70px 0;font-weight: bold;height: 113px;text-align: right;">
                    <div style="min-width: 30px;float: right;height: 113px;font-size: 12px;margin-left: 10px;">
                        <div style="font-size: 30px;position: relative;top: 70px;right: 0px;">
                            Brix
                        </div>
                    </div>
                    <div id="conc" style="margin-right: 10px;font-size: 100px;float: right;">
                        0.000
                    </div>
                </div>
                <div class="clearfix" style="border-top:1px solid #e3e5e4;padding-top: 10px;">
                    <div style="width: 50%;float: right;color: #7C7D7D;">
                        <div style="font-size: 30px;vertical-align: text-top;font-weight: normal;float: right;">
                            °C
                        </div>
                        <div id="temp" style="text-align: right;font-weight: bold;font-size: 55px;margin-right: 20px;float: right;">
                            0
                        </div>
                    </div>
                </div>
                <div class="clearfix" style="border-top:1px solid #e3e5e4;padding-top: 10px;">
                    <div title="折光仪实时数据" id="chartBox">
                        <div id="main" style="width: 1000px; height: 400px; margin: 10px auto;"></div>
                    </div>
                    <form class="col-sm-6">
                      <div class="form-group">
                        <label for="">
                            折光率上限
                            <span style="display: inline-block;margin-bottom:3px;width: 50px;height: 3px;background: #ffd85c;"></span>
                        </label>
                        <input type="number" class="form-control markLineFlg" id="zglTop" value="3"/>
                      </div>
                      <div class="form-group">
                        <label for="">
                            折光率下限
                            <span style="display: inline-block;margin-bottom:3px;width: 50px;height: 3px;background: #ffd85c;"></span>
                        </label>
                        <input type="number" class="form-control markLineFlg" id="zglBottom" value="0.03"/>
                      </div>
                    </form>
                    <form class="col-sm-6">
                      <div class="form-group">
                        <label for="">
                            温度上限
                            <span style="display: inline-block;margin-bottom:3px;width: 50px;height: 3px;background: #37A2DA;"></span>
                        </label>
                        <input type="number" class="form-control markLineFlg" id="wdTop" value="90"/>
                      </div>
                      <div class="form-group">
                        <label for="">
                            温度下限
                            <span style="display: inline-block;margin-bottom:3px;width: 50px;height: 3px;background: #37A2DA;"></span>
                        </label>
                        <input type="number" class="form-control markLineFlg" id="wdBottom" value="10"/>
                      </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</body>
</html>