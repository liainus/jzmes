<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>制药生产计划向导</title>
	<link href="../static/css/base.css" rel="stylesheet">
	<link href="../static/custom/uimaker/easyui.css" rel="stylesheet">
    <link rel="stylesheet" href="../static/css/bootstrap.min.css" crossorigin="anonymous">
    <link href="../static/css/smart_wizard.min.css" rel="stylesheet">
{#	<link href="../static/css/basic_info.css" rel="stylesheet">#}
    <style>
        .sw-theme-arrows {
            border-radius: 5px;
            border: 1px solid #ddd;
            margin:3px;
        }
        .sw-theme-arrows > .sw-container {
            height: 400px;
        }
        .sw-theme-arrows .step-content {
            padding: 0 10px;
            border: 0px solid #D4D4D4;
            background-color: #FFF;
            text-align: left;
        }
        .sw-theme-arrows .sw-toolbar {
            background:#f9f9f9;
            padding: 10px;
            margin-bottom: 0 !important;
        }
        .sw-theme-arrows > .sw-toolbar-top {
        }
        .sw-theme-arrows > .sw-toolbar-bottom {
            text-align: right;
        }
        .btn-toolbar .btn-group, .btn-toolbar .input-group{
            float: none;
        }
        .sw-theme-arrows > ul.step-anchor {
            border: 0;
            border-bottom: 1px solid #ddd;
            padding: 0px;
            background: #f5f5f5;
            border-radius: 0;
            border-top-right-radius: 5px;
            list-style: none;
            overflow: hidden;
        }
        .sw-theme-arrows > ul.step-anchor li+li:before {
            padding: 0;
        }
        .sw-theme-arrows > ul.step-anchor > li {
        }
        .sw-theme-arrows > ul.step-anchor > li > a, .sw-theme-arrows > ul.step-anchor > li > a:hover {
            color: #bbb;
            text-decoration: none;
            padding: 10px 0 10px 45px;
            position: relative;
            display: block;
            border: 0 !important;
            border-radius: 0;
            outline-style: none;
            background: #f5f5f5;
        }
        .sw-theme-arrows > ul.step-anchor > li > a:after {
            content: " ";
            display: block;
            width: 0;
            height: 0;
            border-top: 50px solid transparent;
            border-bottom: 50px solid transparent;
            border-left: 30px solid #f5f5f5;
            position: absolute;
            top: 50%;
            margin-top: -50px;
            left: 100%;
            z-index: 2;
        }
        .sw-theme-arrows > ul.step-anchor > li > a:before {
            content: " ";
            display: block;
            width: 0;
            height: 0;
            border-top: 50px solid transparent;
                   /* Go big on the size, and let overflow hide */
            border-bottom: 50px solid transparent;
            border-left: 30px solid #ddd;
            position: absolute;
            top: 50%;
            margin-top: -50px;
            margin-left: 1px;
            left: 100%;
            z-index: 1;
        }
        .sw-theme-arrows > ul.step-anchor > li:first-child > a {
            padding-left: 15px;
        }
        .sw-theme-arrows > ul.step-anchor > li > a:hover {
            color: #bbb;
            text-decoration: none;
            outline-style: none;
            background: #f5f5f5;
            border-color: #f5f5f5;
        }
        .sw-theme-arrows > ul.step-anchor > li > a:hover:after {
            border-left-color: #f5f5f5;
        }
        .sw-theme-arrows > ul.step-anchor > li > a small {
        }
        .sw-theme-arrows > ul.step-anchor > li.clickable > a:hover {
            color: #4285F4 !important;
            background: #46b8da !important;
        }
        .sw-theme-arrows > ul.step-anchor > li.active > a {
            border-color: #5cb85c !important;
            color: #fff !important;
            background: #5cb85c !important;
        }
        .sw-theme-arrows > ul.step-anchor > li.active > a:after {
            border-left: 30px solid #5cb85c !important;
        }
        .sw-theme-arrows > ul.step-anchor > li.done > a {
            border-color: #b1dfbb !important;
         /*  #5cb85c */
            color: #fff !important;
            background: #b1dfbb !important;
        }
        .sw-theme-arrows > ul.step-anchor > li.done > a:after {
            border-left: 30px solid #b1dfbb;
         /* c3e6cb */;
        }
        .sw-theme-arrows > ul.step-anchor > li.danger > a {
            border-color: #d9534f !important;
            color: #fff !important;
            background: #d9534f !important;
        }
        .sw-theme-arrows > ul.step-anchor > li.danger > a:after {
            border-left: 30px solid #d9534f !important;
        }
        .sw-theme-arrows > ul.step-anchor > li.disabled > a, .sw-theme-arrows > ul.step-anchor > li.disabled > a:hover {
            color: #eee !important;
        }
        /* Responsive CSS */
        @media screen and (max-width: 768px) {
            .sw-theme-arrows > ul.step-anchor {
                border: 0;
                background: #ddd !important;
            }
            .sw-theme-arrows > .nav-tabs > li {
                float: none !important;
                margin-bottom: 0;
            }
            .sw-theme-arrows > ul.step-anchor > li > a, .sw-theme-arrows > ul.step-anchor > li > a:hover {
                padding-left: 15px;
                margin-right: 0;
                margin-bottom: 1px;
            }
            .sw-theme-arrows > ul.step-anchor > li > a:after, .sw-theme-arrows > ul.step-anchor > li > a:before {
                display: none;
            }
        }
        /* Loader Custom Style */
        .sw-theme-arrows::before {
            border: 10px solid #f3f3f3;
            border-top: 10px solid #5cb85c;
        }
        .tab-content>.tab-pane{
            visibility: visible;
        }
        .btn-toolbar .btn-group, .btn-toolbar .input-group{
            float: right;
        }
    </style>
    <script src="../static/kendo/js/jquery.min.js"></script>
    <script type="text/javascript" src="../static/js/jquery.easyui.min.js"></script>
    <script type="text/javascript" src="../static/js/easyui-lang-zh_CN.js"></script>
	<script type="text/javascript" src="../static/js/jquery.smartWizard.min.js"></script>
	<script type="text/javascript" src="../static/js/bee.js" charset="utf-8"></script>
    <script type="text/javascript">
        $(function () {
            $("#APlanDate").datebox("setValue", myformatter(new Date()))
            // Toolbar extra buttons
            var btnCancel = $('<button></button>').text('重置')
                 .addClass('btn btn-danger')
                 .on('click', function(){ $('#wizard').smartWizard("reset"); });
            // Smart Wizard
            $('#wizard').smartWizard({
                    selected: 0,
                    theme: 'arrows',
                    lang: {
                        next: '下一步'
                    },
                    transitionEffect:'fade',
                    transitionSpeed:400,
                    //enableAllAnchors:true,
                    toolbarSettings: {
                        //toolbarButtonPosition: 'end',
                        toolbarExtraButtons: [btnCancel],
                        showPreviousButton:false
                    },
                    anchorSettings:{
                        anchorClickable:false
                    }
            });
            $("#wizard").on("leaveStep", function(e, anchorObject, stepNumber, stepDirection) {
                if(stepNumber == 0){
                    if(Bee.StringUtils.isEmpty($('#ABatchID').val())) {
                        $.messager.alert('提示', '批次号不能为空！', 'info');
                        return false;
                    }
                    if(Bee.StringUtils.isEmpty($('#ABrandName').find("option:selected").val())) {
                        $.messager.alert('提示', '品名不能为空！', 'info');
                        return false;
                    }
                    if(Bee.StringUtils.isEmpty($('#APlanWeight').val())) {
                        $.messager.alert('提示', '计划重量不能为空！', 'info');
                        return false;
                    }
                    if(Bee.StringUtils.isEmpty($('#APLineName').find("option:selected").val())) {
                        $.messager.alert('提示', '生产线不能为空！', 'info');
                        return false;
                    }
                    if(Bee.StringUtils.isEmpty($('#AUnit').find("option:selected").val())) {
                        $.messager.alert('提示', '单位不能为空！', 'info');
                        return false;
                    }
                    $.ajax({
                        url:"/ZYPlanGuid/isBatchNumber",
                        data:{ABatchID:$("#ABatchID").val()},
                        type:"get",
                        async:false,
                        success:function(res){
                            if(res == '"NO"'){
                                alert('Warning：批次号重复！');
                                xhr.abort()
                                return false
                            }else if(res == '"OK"'){
                                return true
                            }
                        },
                        error:function(){
                            alert("请求错误，请刷新后重试！")
                        }
                    })
                    var xhr = $.ajax({
                        url: "/ZYPlanGuid/makePlan",
                        method: 'POST',
                        data: {
                            APlanDate :$('#APlanDate').datebox('getValue'),
                            ABatchID :$('#ABatchID').val(),
                            AProductRuleID :$('#ABrandName').find("option:selected").val(),
                            ABrandName :$('#ABrandName').find("option:selected").html(),
                            APlanWeight :$('#APlanWeight').val(),
                            PLineName :$('#APLineName').find("option:selected").html(),
                            AUnit : $('#AUnit').find("option:selected").val()
                        },
                        //dataType: 'json',
                        success: function (data,response,status) {
                            console.log(data)
                        },
                         error: function(data){
                               alert("异常，请刷新后重试...");
                         }
                    })
                }
            });
            $("#wizard").on("showStep", function(e, anchorObject, stepNumber, stepDirection) {
                if(stepNumber == 1){
                    setTimeout(function() {
                        $("#PlanTab").datagrid('load',{
                            ABatchID :$('#ABatchID').val()
                        })
                        $("#TasksTab").datagrid('load',{
                            ABatchID :$('#ABatchID').val()
                        })
                    },200);
                }
            })
        });
        function myformatter(date){
            var y = date.getFullYear();
            var m = date.getMonth()+1;
            var d = date.getDate();
            return y+'-'+(m<10?('0'+m):m)+'-'+( d<10?('0'+d):d);
        }
        function formatterStatus(value, row, index){
            if (value == 10){
                return '新增'
            }else if(value == 11){
                return '已审核'
            }else if(value == 20){
                return '已下发'
            }else if(value == 30){
                return '中控已确认'
            }else if(value == 31){
                return '中控已复核'
            }else if(value == 32){
                return 'QA已复核'
            }else if(value == 40){
                return '已确认，准备生产'
            }else if(value == 50){
                return '执行'
            }else if(value == 60){
                return '已完成'
            }else if(value == 70){
                return 'QA入库'
            }
        }
	</script>
</head>
<body>
    <div id="wizard" class="sw-main sw-theme-arrows">
        <ul style="margin:10px;">
            <li><a href="#step-1">Step 1<br /><small>批次号品名录入</small></a></li>
            <li><a href="#step-2">Step 2<br /><small>批次计划</small></a></li>
            <li><a href="#step-3">Step 3<br /><small>计划效验结果</small></a></li>
        </ul>
        <div>
            <div id="step-1">
                <h3 class="border-bottom border-gray pb-2">计划实际信息</h3>
                <div class="content">
                    <form id="orgForm" method="post" class="dialog-form">
                        <table class="kv-table">
                            <tbody>
                                <tr>
                                    <td class="kv-label">生产日期</td>
                                    <td class="kv-content">
                                        <input class="easyui-datebox" name="APlanDate" id="APlanDate" labelPosition="top" data-options="required:true,showSeconds:false,editable:false" style="height:29px;">
                                    </td>
                                    <td class="kv-label">批次号</td>
                                    <td class="kv-content">
                                        <input type="text" name="ABatchID" id="ABatchID" class="textbox-text validatebox-text textbox-prompt" autocomplete="off" placeholder="">
                                    </td>
                                    <td class="kv-label">品名</td>
                                    <td class="kv-content">
                                        <select name="ABrandName" id="ABrandName" type="text" autocomplete="off" placeholder="" style="height:29px;width:150px;">
                                            <option value="">请选择</option>
                                            {% for id in Product_info %}
                                                <option value="{{ id['ID'] }}">{{ id['text'] }}</option>
                                            {% endfor %}
                                        </select>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="kv-label">计划重量</td>
                                    <td class="kv-content">
                                        <input id="APlanWeight" class="textbox-text validatebox-text textbox-prompt" name="APlanWeight" type="text">
                                    </td>
                                    <td class="kv-label">生产线</td>
                                    <td class="kv-content">
                                        <select name="APLineCode" id="APLineName" type="text" autocomplete="off" placeholder="" style="height:29px;width:150px;">
                                            <option value="">请选择</option>
                                            {% for id in PLine_info %}
                                                <option value="{{ id['PLineCode'] }}">{{ id['PLineName'] }}</option>
                                            {% endfor %}
                                        </select>
                                    </td>
                                    <td class="kv-label">单位</td>
                                    <td class="kv-content">
                                        <select name="AUnit" id="AUnit" type="text" autocomplete="off" placeholder="" style="height:29px;width:150px;">
                                            <option value="">请选择</option>
                                            {% for id in Unit %}
                                                <option value="{{ id['UnitCode'] }}">{{ id['UnitName'] }}</option>
                                            {% endfor %}
                                        </select>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </form>
                </div>
            </div>
            <div id="step-2">
                <h3 class="border-bottom border-gray pb-2">生成计划信息</h3>
                <div id="tab" class="easyui-tabs" style="width:100%;height:520px;">
                    <div title="批次计划" data-options="closable:false"  style="padding:0px;">
                        <table id="PlanTab" class="easyui-datagrid" style="width:100%;"  data-options="
                             url:'/ZYPlanGuid/searchPlanmanager',
                             method: 'get',
                             rownumbers:true,
                             singleSelect:false,
                             autoRowHeight:false,
                             pagination:true,
                             striped:true,
                             checkOnSelect:false,
                             selectOnCheck:false,
                             collapsible:true,
                             toolbar: '#tb',
                             pageSize:10 " >
                            <thead>
                                <tr>
                                    <th data-options="field: 'SchedulePlanCode',align: 'center',width:200 ">调度编号</th>
                                    <th data-options="field: 'BatchID',align: 'center',width:200 ">批次号</th>
                                    <th data-options="field: 'PlanQuantity',align: 'center',width:100 ">计划重量</th>
                                    <th data-options="field: 'BrandName',align: 'center',width:150 ">品名</th>
                                    <th data-options="field: 'Unit',align: 'center',width:100 ">单位</th>
                                    <th data-options="field: 'PlanStatus',align: 'center',width:100 " formatter="formatterStatus">计划状态</th>
                                    <th data-options="field: 'PlanBeginTime',align: 'center',width:200 ">调度计划开始时间</th>
                                    <th data-options="field: 'PlanEndTime',align: 'center',width:200 ">计划完成时间</th>
                                    <th data-options="field: 'Type',align: 'center',width:100 ">调度类型</th>
                                </tr>
                            </thead>
                        </table>
                    </div>
                    <div title="批次物料明细" data-options="closable:false" style="overflow:auto;padding:0px;">
                        <table id="TasksTab" class="easyui-datagrid" style="width:100%;" data-options="
{#                             url:'/ZYPlanGuid/CriticalMaterials',#}
                             method: 'get',
                             rownumbers:true,
                             singleSelect:false,
                             autoRowHeight:false,
                             pagination:true,
                             striped:true,
                             checkOnSelect:false,
                             selectOnCheck:false,
                             collapsible:true,
                             toolbar: '#tb',
                             pageSize:10 " >
                            <thead>
                                <tr>
                                    <th data-options="field: 'PlanDate',align: 'center' ">计划日期</th>
                                    <th data-options="field: 'TaskID',align: 'center' ">制药计划单号</th>
                                    <th data-options="field: 'BatchID',align: 'center' ">批次号</th>
                                    <th data-options="field: 'PlanSeq',align: 'center' ">顺序号</th>
                                    <th data-options="field: 'PUID',align: 'center' ">工艺段</th>
                                    <th data-options="field: 'PDUnitRouteName',align: 'center' ">工艺路线名称</th>
                                    <th data-options="field: 'PlanType',align: 'center' ">计划类型</th>
                                    <th data-options="field: 'BrandID',align: 'center' ">牌号编码</th>
                                    <th data-options="field: 'BrandName',align: 'center' ">牌号名称</th>
                                    <th data-options="field: 'PlanQuantity',align: 'center' ">计划重量</th>
                                    <th data-options="field: 'ActQuantity',align: 'center' ">实际重量</th>
                                    <th data-options="field: 'Unit',align: 'center' ">单位</th>
                                    <th data-options="field: 'EnterTime',align: 'center' ">录入时间</th>
                                    <th data-options="field: 'ActBeginTime',align: 'center' ">实际开始时间</th>
                                    <th data-options="field: 'ActEndTime',align: 'center' ">实际完成时间</th>
                                    <th data-options="field: 'SetRepeatCount',align: 'center' ">设定重复次数</th>
                                    <th data-options="field: 'CurretnRepeatCount',align: 'center' ">当前重复次数</th>
                                    <th data-options="field: 'ActTank',align: 'center' ">实际罐号</th>
                                    <th data-options="field: 'TaskStatus',align: 'center' ">任务状态</th>
                                    <th data-options="field: 'LockStatus',align: 'center' ">任务锁定状态</th>
                                </tr>
                            </thead>
                        </table>
                    </div>
                </div>
            </div>
            <div id="step-3">
                <h3 class="border-bottom border-gray pb-2">计划校验结果</h3>
                <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.
                    Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute
                    irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat
                    cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
            </div>
        </div>
    </div>
</body>
</html>