<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>组织结构</title>
    <style>
        .node {
          font: 14px sans-serif;
        }
        .link {
          fill: none;
          stroke: #ccc;
          stroke-width: 1.5px;
        }
    </style>
</head>
<body style="background-color: #30aeba;">
    <div id="example" style="text-align: center;"></div>
    <script src="../static/js/jquery.min.js"></script>
    <script src="../static/js/d3.v3.min.js"></script>
    <script>
        $(document).ready(function () {
            var width = 800,
                height = 800;

            //定义数据转换函数
            var cluster  = d3.layout.tree()
                .size([width,height-150])
            //定义对角线生成器diagonal
            var diagonal = d3.svg.diagonal()
                .projection(function(d){
                    return [d.y, d.x]
                })
            //定义svg
            var svg = d3.select("#example").append("svg")
                .attr("width",width)
                .attr("height",height)
                .append("g")
                .attr("transform","translate(40,0)")

            //读取json文件，进行绘图
            d3.json("../static/data/tree_test.json",function(error,data){
                console.log(data)
                var nodes = cluster.nodes(data);
                var links = cluster.links(nodes);
                //为关系集合设置贝塞尔曲线连接
                var link = svg.selectAll(".link")
                    .data(links)
                    .enter()
                    .append("path")
                    .attr("class", "link")
                    .attr("d", function(d){
                        return "M"+d.source.y+" "+d.source.x+
                        "L"+(d.source.y+120)+" "+d.source.x+
                        "L"+(d.source.y+120)+" "+d.target.x+" L"+
                        d.target.y+" "+d.target.x;
                    })
                    .attr("style",function(){
                        return "stroke:#ffffff"
                    });
                var node = svg.selectAll(".node")
                    .data(nodes)
                    .enter()
                    .append("g")
                    .attr("class", "node")
                    .attr("transform", function(d) {
                        return "translate(" + d.y + "," + (d.x+ -15) + ")";
                    })
                    .on("click",function(d,i){
                        console.log(d)
                        alert("你点击的是"+ d.name +",他的编号为" + d.number + ",索引值为" + i);
                    })
                //加内容模块 背景、宽高、位置
                node.append("rect")
                    .attr("width",120)
                    .attr("height",35)
                    .attr("x",-40)
                    .attr("y",0)
                    .attr("rx",3)
                    .attr("ry",3)
                    .attr("style","fill:#0e546d;")

                //加文字 dx左右位置 dy上下位置
                node.append("text")
                    .attr("dx", function(d) {
                        return 15;
                    })
                    .attr("dy", 23)
                    .style("text-anchor", function(d) {
                        return "middle";
                    })
                    .style("fill","#fff")
                    .text(function(d) {
                        return d.name;
                    })

                //加数量
{#                node.append("text")#}
{#                    .attr("dx", function(d) {#}
{#                        return 75;#}
{#                    })#}
{#                    .attr("dy", 18)#}
{#                    .style("text-anchor", function(d) {#}
{#                        return "middle";#}
{#                    })#}
{#                    .style("fill","#fff")#}
{#                    .text(function(d) {#}
{#                        return d.number;#}
{#                    })#}
                })
        })
    </script>
</body>
</html>
