<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Basic usage</title>
    <style>
        .node {
          font: 14px sans-serif;
        }
        .link {
          fill: none;
          stroke: #ccc;
          stroke-width: 1.5px;
        }
    </style>
</head>
<body>
    <div id="example"></div>
{#    <script src="../static/js/d3.v4.min.js"></script>#}
{#    ../static/data/tree_organization.json#}
    <script src="../static/js/jquery.min.js"></script>
    <script src="../static/js/d3.v3.min.js"></script>
    <script>
        $(document).ready(function () {
            var width = 600,
                height = 600;

            //定义数据转换函数
            var cluster  = d3.layout.tree()
                .size([width,height-150])
            //定义对角线生成器diagonal
            var diagonal = d3.svg.diagonal()
                .projection(function(d){
                    return [d.y, d.x]
                })
            //定义svg
            var svg = d3.select("#example").append("svg")
                .attr("width",width)
                .attr("height",height)
                .append("g")
                .attr("transform","translate(40,0)")

            //读取json文件，进行绘图
            d3.json("../static/data/tree_test.json",function(error,root){
                var nodes = cluster .nodes(root);
                var links = cluster .links(nodes);
                var link = svg.selectAll(".link")
                    .data(links)
                    .enter()
                    .append("path")
                    .attr("class", "link")
                    .attr("d", function(d){
                        return "M"+d.source.y+" "+d.source.x+
                        "L"+(d.source.y+120)+" "+d.source.x+
                        " L"+(d.source.y+120)+" "+d.target.x+" L"+
                        d.target.y+" "+d.target.x;
                    })
                    .attr("style",function(){
                        return "stroke:#F7881F"
                    });
                var node = svg.selectAll(".node")
                    .data(nodes)
                    .enter()
                    .append("g")
                    .attr("class", "node")
                    .attr("transform", function(d) {
                        return "translate(" + d.y + "," + (d.x+ -15) + ")";
                    })
                //加内容模块 背景、宽高、位置
                var nodeItem = node.append("rect")
                    .attr("width",90)
                    .attr("height",25)
                    .attr("x",0)
                    .attr("y",0)
                    .attr("style","fill:#35AD5B;");
                nodeItem.on("mouseover",function(){
                    console.log(1);
                })

                //加文字 dx左右位置 dy上下位置
                var nodeTxt = node.append("text")
                    .attr("dx", function(d) {
                        return 35;
                    })
                    .attr("dy", 18)
                    .style("text-anchor", function(d) {
                        return "middle";
                    })
                    .style("fill","#fff")
                    .text(function(d) {
                        return d.name;
                    });
                nodeTxt.on("mouseover",function(){
                    console.log(1);
                })
                //加数量
                var nodeNum = node.append("text")
                    .attr("dx", function(d) {
                        return 75;
                    })
                    .attr("dy", 18)
                    .style("text-anchor", function(d) {
                        return "middle";
                    })
                    .style("fill","#fff")
                    .text(function(d) {
                        return d.number;
                    });
                nodeNum.on("mouseover",function(){
                    console.log(1);
                })
            })
        })
    </script>
</body>
</html>
