<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>物料追溯</title>
    <link rel="stylesheet" href="../static/css/bootstrap.min.css" crossorigin="anonymous">
    <link rel="stylesheet" href="../static/css/bootstrap-datetimepicker.min.css" crossorigin="anonymous">
    <script type="text/javascript" src="../static/js/echarts.common.min.js"></script>
    <script type="text/javascript" src="../static/js/jquery-3.3.1.min.js"></script>
    <script type="text/javascript" src="../static/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../static/js/bootstrap-datetimepicker.min.js"></script>
    <script>
        $(function(){
            $('#beginTimeDate,#endTimehDate').datetimepicker({
                format: 'yyyy-mm-dd',
                startView: 2,
		        minView: 2,
                autoclose: true
            });
            $("#beginTimeDate,#endTimehDate").datetimepicker("setDate", new Date());

            var brand = ""
            $("#seachBatch").on('click',function(){
                if($("#BatchName").find("option:selected").html() == "健胃消食片浸膏粉"){
                    brand = "A"
                }else if($("#BatchName").find("option:selected").html() == "肿节风浸膏"){
                    brand = "B"
                }
                $.ajax({
                    url:'/BatchMaterialTracing/GetData',
                    type:'get',
                    data:{
                        beginTime:$('#beginTimeDate').data("datetimepicker").getDate(),
                        endTime:$('#endTimehDate').data("datetimepicker").getDate(),
                        brand:$("#BatchName").find("option:selected").html()
                    },
                    success:function(data){
                        data = JSON.parse(data)
                        $("#batch").html("<option>请选择</option>")
                        for (var i = 0; i < data.batchs.length; i++) {
                            $("#batch").append("<option>"+ data.batchs[i] + "</option>")
                        }
                    }
                })
            })
            $("#batch").on('change',function(){
                $.ajax({
                    url:'/BatchMaterialTracing/BatchData',
                    type:'get',
                    data:{
                        batch:$(this).find("option:selected").html(),
                        brand:brand
                    },
                    success:function(data){
                        data = JSON.parse(data)

                    }
                })
            })
            function TQchartFun(){
                var myChart = echarts.init($("#TQchart"))
                myChart.showLoading();
                $.ajax({
                    url: "/HomePageHistogram",
                    type: "get",
                    data:{

                    },
                    success: function (data) {
                        myChart.hideLoading();
                        myChart.setOption(option = {
                            tooltip: {
                                trigger: 'axis',
                                axisPointer: {
                                    type: 'shadow'
                                }
                            },
                            legend: {
                                data: ['投入量']
                            },
                            toolbox: {
                                feature: {
                                    dataView: {show: true, readOnly: false},
                                    magicType: {show: true, type: ['line', 'bar']},
                                    restore: {show: true},
                                    saveAsImage: {show: true}
                                }
                            },
                            dataZoom : {
                                show : true,
                                realtime : true,
                                start : 50,
                                end : 100
                            },
                            xAxis: {
                                type: 'category',
                                data: data[0].batch
                            },
                            yAxis: [
                                {
                                    type: 'value',
                                    name: '重量',
                                    min: 0,
                                    interval: 500,
                                    axisLabel: {
                                        formatter: '{value} kg'
                                    }
                                }
                            ],
                            series: [{
                                name: "投入量",
                                type: 'bar',
                                label: {
                                    normal: {
                                        show: true,
                                        position: 'top'
                                    }
                                },
                                itemStyle:{
                                    normal:{
                                        color:'#90ed7d'
                                    }
                                },
                                data: data[0].input
                            }]
                        });
                        myChart.setOption(option);
                    }
                })
            }
            function adddata(ids,res){
                $("#" + ids).html(res)
            }
        })
    </script>
</head>
<body>
    <div class="modal" id="loadingModal1">
        <div style="width: 200px;height:20px; z-index: 20000; position: absolute; text-align: center; left: 50%; top: 50%;margin-left:-100px;margin-top:-10px">
            <div class="progress progress-striped active" style="margin-bottom: 0;">
                <div class="progress-bar" style="width: 100%;"></div>
            </div>
            <h5>正在加载健胃消食片的物料信息。。。</h5>
        </div>
    </div>
    <div class="modal" id="loadingModal2">
        <div style="width: 200px;height:20px; z-index: 20000; position: absolute; text-align: center; left: 50%; top: 50%;margin-left:-100px;margin-top:-10px">
            <div class="progress progress-striped active" style="margin-bottom: 0;">
                <div class="progress-bar" style="width: 100%;"></div>
            </div>
            <h5>正在加载肿节风浸膏的物料信息。。。</h5>
        </div>
    </div>
    <div class="container">
        <div class="page-header">
            <div class="form-inline">
                <div class="form-group clearfix">
                    <label for="" class="control-label">选择品名：</label>
                    <select id="BatchName" class="form-control">
                        {% for brand in brands %}
                            <option>{{ brand[0] }}</option>
                        {% endfor %}
                    </select>
                    <label for="" class="control-label"> 开始时间：</label>
                    <input type="text" class="form-control" id="beginTimeDate">
                    <label for="" class="control-label"> 结束时间：</label>
                    <input type="text" class="form-control" id="endTimehDate">
                    <button class="btn btn-primary" id="seachBatch"> 查询批次号</button>
                    <select id="batch" class="form-control">
                        <option value="">请选择</option>
                    </select>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-12">
        <div class="well">
            <div class="chartItem" id="chartMain" style="width: 900px; height: 400px; margin: 10px auto;"></div>
        </div>
    </div>
</body>
</html>