<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>工作台</title>
    <link href="../static/css/base.css" rel="stylesheet">
	<link rel="stylesheet" href="../static/custom/uimaker/easyui.css">
    <link rel="stylesheet" href="../static/css/bootstrap.min.css">
    <link rel="stylesheet" href="../static/css/bootstrap-table.min.css">
    <style>
        .content{
            background: #fff;
            padding:20px;
        }
        .AgencyArea{
            position: relative;
            background: #fff;
            font-size: 14px;
            text-align: center;
        }
        .AgencyArea .AgencyArea-item{
            background: #2fd6a0;
            color: #fff;
            padding: 10px 0;
            border-radius: 5px;
            margin-bottom: 15px;
        }
        .AgencyArea h3{
            font-size: 28px;
            font-weight: bold;
        }
        .AgencyArea .AgencyArea-item:nth-child(4n+1) h3{
            color: #46b8da;
        }
        .AgencyArea .AgencyArea-item:nth-child(4n+2) h3{
            color: #f0ad4e;
        }
        .AgencyArea .AgencyArea-item:nth-child(4n+3) h3{
            color: #5cb85c;
        }
        .AgencyArea .AgencyArea-item:nth-child(4n) h3{
            color: #337ab7;
        }
        .panel-body{
            border:none;
        }
    </style>
</head>
<body>
    <div class="modal" id="loadingModal" data-backdrop="static" data-keyboard="false">
        <div style="width: 200px;height:20px; z-index: 20000; position: absolute; text-align: center; left: 50%; top: 50%;margin-left:-100px;margin-top:-10px">
            <div class="progress progress-striped active" style="margin-bottom: 0;">
                <div class="progress-bar" style="width: 100%;"></div>
            </div>
            <h5>正在加载...</h5>
        </div>
    </div>
    <div class="content clearfix">
        <div class="col-md-12">
            <div class="row">
                <div class="col-md-8 col-sm-12">
                    <div class="row AgencyArea">
                        <div class="col-md-3" skip-src="/ZYPlanGuid/checkplanmanager" title="审核计划">
                            <div class="AgencyArea-item">
                                <h3 id="daiban1">0</h3>
                                <span><i class="glyphicon glyphicon-check"></i> 计划待审核</span>
                            </div>
                        </div>
                        <div class="col-md-3" skip-src="/ZYPlanGuid/planmanager" title="下发计划">
                            <div class="AgencyArea-item">
                                <h3 id="daiban2">0</h3>
                                <span><i class="glyphicon glyphicon-send"></i> 计划待下发</span>
                            </div>
                        </div>
                        <div class="col-md-3" skip-src="/QAauthPass" title="QA放行">
                            <div class="AgencyArea-item">
                                <h3 id="daiban3">0</h3>
                                <span><i class="glyphicon glyphicon-log-out"></i> 计划待入库</span>
                            </div>
                        </div>
                        <div class="col-md-3" skip-src="/BatchMaterielBalanceStatistic" title="批物料平衡统计">
                            <div class="AgencyArea-item">
                                <h3 id="daiban4">0</h3>
                                <span><i class="glyphicon glyphicon-pencil"></i> 物料平衡待确认</span>
                            </div>
                        </div>
                        <div class="col-md-3" skip-src="/BatchMaterielBalanceStatistic" title="设备故障待维修">
                            <div class="AgencyArea-item">
                                <h3 id="daiban4">0</h3>
                                <span><i class="glyphicon glyphicon-pencil"></i> 设备故障待维修</span>
                            </div>
                        </div>
                        <div class="col-md-3" skip-src="/BatchMaterielBalanceStatistic" title="设备故障待完成">
                            <div class="AgencyArea-item">
                                <h3 id="daiban4">0</h3>
                                <span><i class="glyphicon glyphicon-pencil"></i> 设备故障待完成</span>
                            </div>
                        </div>
                        <div class="col-md-3" skip-src="/BatchMaterielBalanceStatistic" title="设备检修待完成">
                            <div class="AgencyArea-item">
                                <h3 id="daiban4">0</h3>
                                <span><i class="glyphicon glyphicon-pencil"></i> 设备检修待完成</span>
                            </div>
                        </div>
                        <div class="col-md-3" skip-src="/BatchMaterielBalanceStatistic" title="设备检修待审核">
                            <div class="AgencyArea-item">
                                <h3 id="daiban4">0</h3>
                                <span><i class="glyphicon glyphicon-pencil"></i> 设备检修待审核</span>
                            </div>
                        </div>
                    </div>
                    <div id="compareBox" style="width: 100%;width: 100%; margin: 10px auto;">
                        <div id="CompareMain" style="width: 700px; height: 380px;"></div>
                    </div>
                </div>
                <div class="col-md-4 col-sm-12">
                    <div class="panel panel-widget" style="background: #e3e3e3;">
                        <div class="panel-heading">制药计划待处理列表<a href="javascript:;" id="toZYPlanManage" style="float: right">去处理</a></div>
                        <div class="panel-body">
                            <table id="planTable" class="table table-striped"></table>
                        </div>
                    </div>
                    <div class="panel panel-widget" style="background: #e3e3e3;">
                        <div class="panel-heading">备件待审核列表<a href="javascript:;" id="toEquipmentspare" style="float: right">去审核</a></div>
                        <div class="panel-body">
                            <table id="spareTable" class="table table-striped"></table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script type="text/javascript" src="../static/js/echarts.common.min.js"></script>
    <script type="text/javascript" src="../static/js/jquery-3.3.1.min.js"></script>
    <script type="text/javascript" src="../static/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../static/js/bootstrap-table.min.js"></script>
    <script type="text/javascript" src="../static/js/bootstrap-table-zh-CN.min.js"></script>
    <script type="text/javascript" src="../static/js/jquery.easyui.min.js"></script>
    <script type="text/javascript">
        //chart0
        $(document).ready(function () {
            //待办事项数量 a b c d
            $.ajax({
                url: '/souyesearch',
                method: 'get',
                success: function (data) {
                    data = JSON.parse(data)
                    $("#daiban1").html(data.A)
                    $("#daiban2").html(data.B)
                    $("#daiban3").html(data.C)
                    $("#daiban4").html(data.D)
                },
                error: function () {
                    alert("获取待办数据失败，请稍后重试！")
                }
            });
            $("#planTable").bootstrapTable({
                url:'/maindaiban',
                method: 'get',
                height:320,
                columns: [{
                    field: 'BrandName',
                    title: '品名'
                }, {
                    field: 'BatchID',
                    title: '批次号'
                }, {
                    field: 'PlanStatus',
                    title: '计划状态',
                    formatter:function(value,row,index){
                        if (value == 10){
                            return '新增计划'
                        }else if(value == 11){
                            return '审核计划'
                        }else if(value == 20){
                            return '下发计划'
                        }else if(value == 40){
                            return '撤回计划'
                        }else if(value == 50){
                            return '执行计划'
                        }else if(value == 60){
                            return '完成计划'
                        }else if(value == 70){
                            return 'QA入库'
                        }
                    }
                }]
            })

            //有此权限时增加tabs跳转到操作页面 审核-下发-放行-物料平衡
            $(".AgencyArea-item").on('click',function(){
                var text = $(this).attr("title")
                var src = $(this).attr("skip-src")
                $.ajax({
                    url: '/ZYPlanGuid/menuRedirect',
                    method: 'POST',
                    data: {
                        menuName: text
                    },
                    beforeSend:function (){
                        $("#loadingModal").modal('show');
                    },
                    success: function (data) {
                        if (data == "OK") {
                            $("#loadingModal").modal('hide');
                            addTab(text,src)
                        }else{
                            $("#loadingModal").modal('hide');
                            $.messager.alert('提示', data, 'info');
                        }
                    },
                    error: function () {
                        $("#loadingModal").modal('hide');
                        alert("请求失败，请稍后重试！")
                    }
                });
            })

            //投入产出数据图表
            var myDiv = document.getElementById("CompareMain")
            var myChartContainer = function () {
                var width = $("#compareBox").width()
                myDiv.style.width = width +'px';
            };
            myChartContainer();
            myChart = echarts.init(myDiv)
            myChart.showLoading();
            $.ajax({
                url: "/HomePageHistogram",
                type: "get",
                dataType: "json",
                traditional:true,
                success: function (data) {
                    myChart.hideLoading();
                    myChart.setOption(option = {
                        title:{
                            text: data[0].time + "-数据对比"
                        },
                        tooltip: {
                            trigger: 'axis',
                            axisPointer: {
                                type: 'shadow'
                            }
                        },
                        legend: {
                            data: ['投入量', '产出量', '得率']
                        },
                        toolbox: {
                            feature: {
                                dataView: {show: true, readOnly: false},
                                magicType: {show: true, type: ['line', 'bar']},
                                restore: {show: true},
                                saveAsImage: {show: true}
                            }
                        },
                        dataZoom : {
                            show : true,
                            realtime : true,
                            start : 95,
                            end : 100
                        },
                        xAxis: {
                            type: 'category',
                            data: data[0].batch
                        },
                        yAxis: [
                            {
                                type: 'value',
                                name: '重量',
                                min: 0,
                                interval: 500,
                                axisLabel: {
                                    formatter: '{value} kg'
                                }
                            }, {
                                type: 'value',
                                name: '百分比',
                                min: 0,
                                max: 100,
                                interval: 10,
                                axisLabel: {
                                    formatter: '{value} %'
                                }
                            }
                        ],
                        series: [{
                            name: "投入量",
                            type: 'bar',
                            label: {
                                normal: {
                                    show: true,
                                    position: 'top'
                                }
                            },
                            itemStyle:{
                                normal:{
                                    color:'#90ed7d'
                                }
                            },
                            data: data[0].input
                        }, {
                            name: "产出量",
                            type: 'bar',
                            label: {
                                normal: {
                                    show: true,
                                    position: 'top'
                                }
                            },
                            itemStyle:{
                                normal:{
                                    color:'#f7a35c'
                                }
                            },
                            data: data[0].output
                        }, {
                            name: "得率",
                            type: 'bar',
                            yAxisIndex: 1,
                            label: {
                                normal: {
                                    show: true,
                                    position: 'top',
                                    formatter: '{c} %'
                                }
                            },
                            itemStyle:{
                                normal:{
                                    color:'#7cb5ec'
                                }
                            },
                            data: data[0].sampling_quantity
                        }]
                    });
                    myChart.setOption(option);
                }
            })
            parent.$(window).resize(function(){
                myChartContainer();
                myChart.resize();
            })

            //增加tabs跳转到制药计划管理
            $("#toZYPlanManage").on('click',function(){
                addTab("制药计划管理","/ZYPlanManage")
            })
            //增加tabs跳转到备件管理
            $("#toEquipmentspare").on('click',function(){
                addTab("设备备件管理","/equipmentspare")
            })
        });
        //按钮点击后添加选项卡
        function addTab(title, url) {
            if (parent.$('.easyui-tabs1').tabs('exists', title)) {
                parent.$('.easyui-tabs1').tabs('select', title);
            }
            else {
                var content = '<iframe class="page-iframe" src="' + url + '" frameborder="no" border="no" height="100%" width="100%" scrolling="auto"></iframe>';
                parent.$('.easyui-tabs1').tabs('add', {
                    title: title,
                    content: content,
                    closable: true
                });
            }
        }
    </script>
</body>
</html>